---
id: upgrade-v4
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# ì—…ê·¸ë ˆì´ë“œ ê°€ì´ë“œ (v4)

NextAuth.js ë²„ì „ 4ì—ëŠ” ì§€ë‚œ ì£¼ìš” ë²„ì „(3.x)ì—ì„œ ëª‡ ê°€ì§€ íšê¸°ì ì¸ ë³€ê²½ ì‚¬í•­ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ìµœëŒ€í•œ ì›í™œí•˜ê²Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì—…ê·¸ë ˆì´ë“œí•  ìˆ˜ ìˆë„ë¡ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ë‹¤ìŒ ëª‡ ê°€ì§€ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„ì— ë”°ë¼ 3.x ë²„ì „ì—ì„œ ìµœì‹  4 ë¦´ë¦¬ì¦ˆë¡œ ì—…ê·¸ë ˆì´ë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

:::note[ì°¸ê³ ]

ë²„ì „ 4ê°€ GAë¡œ ì¶œì‹œë˜ì—ˆìŠµë‹ˆë‹¤ ğŸš¨.

ì‚¬ìš©ì ì—¬ëŸ¬ë¶„ê»˜ì„œ ì§ì ‘ ì‚¬ìš©í•´ ë³´ì‹œê³  ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì œë³´í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
:::


ë‹¤ìŒì„ ì‹¤í–‰í•˜ì—¬ ìƒˆ ë²„ì „ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
<Tabs>
  <TabItem value="npm" label="npm" default>
    ```bash showLineNumbers
    npm install next-auth
    ```
  </TabItem>
  <TabItem value="yarn" label="yarn">
    ```bash showLineNumbers
    yarn add next-auth
    ```
  </TabItem>
  <TabItem value="pnpm" label="pnpm">
    ```bash showLineNumbers
    pnpm add next-auth
    ```
  </TabItem>
</Tabs>

## `next-auth/jwt`[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#next-authjwt "Direct link to heading")

ë” ì´ìƒ `next-auth/jwt`ì— ê¸°ë³¸ ë‚´ë³´ë‚´ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤. ì´ë¥¼ ì¤€ìˆ˜í•˜ë ¤ë©´ ë‹¤ìŒì„ ë³€ê²½í•˜ì„¸ìš”:

```diff
- import jwt from "next-auth/jwt"
+ import { getToken } from "next-auth/jwt"
```

## `next-auth/react`[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#next-authreact "Direct link to heading")

í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê°€ì ¸ì˜¤ê¸° ì†ŒìŠ¤ì˜ ì´ë¦„ì„ `next-auth/react`ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤. ì´ ë³€ê²½ ì‚¬í•­ì„ ì¤€ìˆ˜í•˜ë ¤ë©´ `next-auth/client`ë¥¼ ì‚¬ìš©í•˜ë˜ ê³³ì˜ ì´ë¦„ì„ ë°”ê¾¸ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

ì˜ˆì‹œ:

```diff
- import { useSession } from "next-auth/client"
+ import { useSession } from "next-auth/react"
```

ë‚´ë³´ë‚´ê¸° ì´ë¦„ë„ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½í–ˆìŠµë‹ˆë‹¤:

- `setOptions`: ë” ì´ìƒ ë…¸ì¶œë˜ì§€ ì•ŠìŒ, [`SessionProvider` props](https://nextauth-ko.wsbox.pw/getting-started/client#options)ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”
- `options`: ë” ì´ìƒ ë…¸ì¶œë˜ì§€ ì•ŠìŒ, [`SessionProvider` propsë¥¼ ì‚¬ìš©í•˜ì„¸ìš”](https://nextauth-ko.wsbox.pw/getting-started/client#options)
- `session`: `getSession`ìœ¼ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
- `providers`: `getProviders`ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
- `csrfToken`: `getCsrfToken`ìœ¼ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
- `signin`: `signIn`ìœ¼ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
- `signout`: `signOut`ìœ¼ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
- `Provider`: `SessionProvider`ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.

https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.12 ì— ë„ì…ë˜ì—ˆìŠµë‹ˆë‹¤

## `SessionProvider`[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#sessionprovider "Direct link to heading")

ë²„ì „ 4ì—ì„œëŠ” `SessionProvider` ì‚¬ìš©ì´ ì˜ë¬´í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì¦‰, ì•„ì§ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ì´ ê³µê¸‰ìì—ì„œ `useSession`ì„ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ëª¨ë“  ë¶€ë¶„ì„ ë˜í•‘í•´ì•¼ í•©ë‹ˆë‹¤. `SessionProvider`ë„ ëª‡ ê°€ì§€ ì¶”ê°€ ë³€ê²½ì´ ìˆì—ˆìŠµë‹ˆë‹¤:
-   `Provider`ëŠ” `SessionProvider`ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
-   options ì†ì„±ì€ ì´ì œ SessionProviderì˜ ì†ì„±ìœ¼ë¡œ ë³‘í•©ë˜ì—ˆìŠµë‹ˆë‹¤.
-   `keepAlive`ì€ ì´ì œ `refetchInterval`ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
-   `clientMaxAge`ëŠ” `refetchInterval`ê³¼ ê¸°ëŠ¥ì´ ê²¹ì¹˜ë¯€ë¡œ ì œê±°ë˜ì—ˆì§€ë§Œ, `refetchInterval`ì˜ í•œê°€ì§€ ë‹¤ë¥¸ì ì€ ì„¸ì…˜ ìœ ì§€ë¥¼ ìœ„í•´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì£¼ê¸°ì ìœ¼ë¡œ ì¬ìš”ì²­ì„ ë‚ ë¦½ë‹ˆë‹¤.

ì•±ì„ í”„ë¡œë°”ì´ë”ë¡œ ë˜í•‘í•˜ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ `pages/_app.jsx` íŒŒì¼ì—ì„œ ë˜í•‘í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ìƒˆë¡œìš´ ë³€ê²½ ì‚¬í•­ì´ ì ìš©ëœ ì‚¬ìš© ì‚¬ë¡€ì˜ ì˜ˆì‹œì…ë‹ˆë‹¤:

```jsx
import { SessionProvider } from "next-auth/react"
export default function App({
  Component,
  pageProps: { session, ...pageProps },
}) {
   return (
    // `session`ì€ `getServerSideProps` ë˜ëŠ” `getInitialProps`ì—ì„œ ë‚˜ì˜µë‹ˆë‹¤.
    // ì²« ë²ˆì§¸ ë¡œë“œ ì‹œ ê¹œë°•ì„/ì„¸ì…˜ ë¡œë”©ì„ ë°©ì§€í•©ë‹ˆë‹¤.
    <SessionProvider session={session} refetchInterval={5 * 60}>
      <Component {...pageProps} />
    </SessionProvider>
  )
}
```

[https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.12](https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.12)ì— ë„ì…ë˜ì—ˆìŠµë‹ˆë‹¤

## ê³µê¸‰ì[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#providers "Direct link to heading")

ì´ì œ ê³µê¸‰ìëŠ” ê°œë³„ì ìœ¼ë¡œ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤.

```diff
- import Provider from "next-auth/providers"
- Providers.Auth0({...})
- Providers.Google({...})
+ import Auth0Provider from "next-auth/providers/auth0"
+ import GoogleProvider from "next-auth/providers/google"
+ Auth0Provider({...})
+ GoogleProvider({...})
```

1.  `AzureADB2C` ê³µê¸‰ìì˜ ì´ë¦„ì´ `AzureAD`ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
2.  `Basecamp` ê³µê¸‰ìê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤([ì—¬ê¸°](https://github.com/basecamp/api/blob/master/sections/authentication.md#on-authenticating-users-via-oauth)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”).
3.  ì´ì œ ê¸°ë³¸ì ìœ¼ë¡œ GitHub ê³µê¸‰ìëŠ” ì‚¬ìš©ì í”„ë¡œí•„ì— ëŒ€í•œ ì „ì²´ ì“°ê¸° ê¶Œí•œì„ ìš”ì²­í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ ë²”ìœ„ê°€ í•„ìš”í•œ ê²½ìš° ë²”ìœ„ ì˜µì…˜ì— `user`ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•˜ì„¸ìš”.

êµ¬ì„±ì—ì„œ ì œê³µì—…ì²´ë¥¼ ì •ì˜í•  ë•Œ ë‹¤ìŒê³¼ ê°™ì€ ìƒˆë¡œìš´ ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1.  `authorization` (`authorizationUrl`, `authorizationParams`, `scope`ë¥¼ ëŒ€ì²´í•¨)
2.  `token` (`accessTokenUrl`, `headers`, `params`ë¥¼ ëŒ€ì²´í•¨)
3.  `userinfo` (`profileUrl`ë¥¼ ëŒ€ì²´í•¨)
4.  `issuer`(`domain`ë¥¼ ëŒ€ì²´í•¨)

ì‚¬ìš©ë²•ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ OAuth ê³µê¸‰ì ë¬¸ì„œì˜ [ì˜µì…˜](https://nextauth-ko.wsbox.pw/configuration/providers/oauth#options) ì„¹ì…˜ì„ ì°¸ì¡°í•˜ì„¸ìš”.

ë ˆí¬ì§€í† ë¦¬ì— ìƒˆ OAuth ê³µê¸‰ìë¥¼ ì œì¶œí•  ë•Œ ì´ì œë¶€í„° `profile` ì½œë°±ì€ ë‹¤ìŒ í•„ë“œë§Œ ë°˜í™˜í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤: `id`, `name`, `email`, ê·¸ë¦¬ê³  `image`. ì´ ì¤‘ í•˜ë‚˜ë¼ë„ ëˆ„ë½ëœ ê°’ì´ ìˆìœ¼ë©´ `null`ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

ë˜í•œ `id`ëŠ” `string` ìœ í˜•ìœ¼ë¡œ ë°˜í™˜ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤(ì˜ˆë¥¼ ë“¤ì–´ ê³µê¸‰ìê°€ ìˆ«ìë¡œ ë°˜í™˜í•˜ëŠ” ê²½ìš° `.toString()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìºìŠ¤íŒ…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤). ì´ë ‡ê²Œ í•˜ë©´ ë°˜í™˜ëœ í”„ë¡œí•„ ê°ì²´ê°€ ëª¨ë“  ê³µê¸‰ì/ê³„ì •/ì–´ëŒ‘í„°ì—ì„œ í˜¸í™˜ë˜ë¯€ë¡œ í–¥í›„ í˜¼ë€ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

êµ¬í˜„: [#2411](https://github.com/nextauthjs/next-auth/pull/2411) [https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.20](https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.20)ì—ì„œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤

## `useSession` í›…[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#usesession-hook "Direct link to heading")

`useSession` í›…ì´ ê°ì²´ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ìƒˆë¡œìš´ `status` ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ìƒíƒœë¥¼ í›¨ì”¬ ë” ê¹”ë”í•˜ê²Œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```diff
- const [ session, loading ] = useSession()
+ const { data: session, status } = useSession()
+ const loading = status === "loading"
```

`session.status`ì™€ `session.data`ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ê°’ì€ [ë¬¸ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”](https://nextauth-ko.wsbox.pw/getting-started/client#usesession).

[https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.18](https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.18)ì—ì„œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤.

## ì •ì˜ëœ ë§¤ê°œë³€ìˆ˜[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#named-parameters "Direct link to heading")

ì½œë°±ì— ëŒ€í•œ ì¸ìˆ˜ë¥¼ ëª…ëª…ëœ ë§¤ê°œë³€ìˆ˜ íŒ¨í„´ìœ¼ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë”ë¯¸ `_` ìë¦¬ í‘œì‹œìë‚˜ ë‹¤ë¥¸ íŠ¸ë¦­ì„ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

### ì½œë°±[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#callbacks "Direct link to heading")

ì´ì œ ì½œë°± ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜ê°’ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

```diff
- signIn(user, account, profileOrEmailOrCredentials)
+ signIn({ user, account, profile, email, credentials })
```

```diff
- redirect(url, baseUrl)
+ redirect({ url, baseUrl })
```

```diff
- session(session, tokenOrUser)
+ session({ session, token, user })
```

```diff
- jwt(token, user, account, OAuthProfile, isNewUser)
+ jwt({ token, user, account, profile, isNewUser })
```

[https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.17](https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.17)ì—ì„œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤.

### ì´ë²¤íŠ¸[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#events "Direct link to heading")

`signOut`ê³¼ `updateUser` ë‘ ê°œì˜ ì´ë²¤íŠ¸ë„ ì •ì˜ëœ ë§¤ê°œë³€ìˆ˜ íŒ¨í„´ì„ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.

```diff title="[...nextauth].js"
...
events: {
-   signOut(tokenOrSession),
+   signOut({ token, session }), // token if using JWT, session if DB persisted sessions.
-   updateUser(user)
+   updateUser({ user })
}
```

[https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.20](https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.20)ì—ì„œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤.


## JWT êµ¬ì„±[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#jwt-configuration "Direct link to heading")

ìš°ë¦¬ëŠ” JSON Web Tokensë¥¼ êµ¬ì„±í• ë•Œ ì¼ë¶€ [êµ¬ì„±ì˜µì…˜](https://nextauth-ko.wsbox.pw/configuration/options)ì„ ì œê±° í•˜ì˜€ìœ¼ë©°, ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”](https://github.com/nextauthjs/next-auth/pull/3039).

```diff
export default NextAuth({
  // ...
    jwt: {
      secret,
      maxAge,
-     encryptionKey
-     signingKey
-     encryptionKey
-     verificationOptions
    encode({
      token
      secret
      maxAge
-     signingKey
-     signingOptions
-     encryptionKey
-     encryptionOptions
-     encryption
    }) {},
    decode({
      token      
      secret
-     maxAge
-     signingKey
-     verificationKey
-     verificationOptions
-     encryptionKey
-     decryptionKey
-     decryptionOptions
-     encryption
    }) {}
  }
})
```

## ë¡œê±° API[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#logger-api "Direct link to heading")

ë¡œê±° APIëŠ” ìµœëŒ€ ë‘ ê°œì˜ ë§¤ê°œë³€ìˆ˜ë§Œ ì‚¬ìš©í•˜ë„ë¡ ë‹¨ìˆœí™”ë˜ì—ˆìœ¼ë©°, ë‘ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ëŠ” ì¼ë°˜ì ìœ¼ë¡œ `error` ê°ì²´ë¥¼ í¬í•¨í•˜ëŠ” ê°ì²´(`metadata`)ì…ë‹ˆë‹¤. ë¡œê±° ì„¤ì •ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” ì´ ë³€ê²½ ì‚¬í•­ì„ ë¬´ì‹œí•´ë„ ë©ë‹ˆë‹¤.

```diff title="[...nextauth.js]"
import log from "some-logger-service"
...
logger: {
-   error(code, ...message) {},
+   error(code, metadata) {},
-   warn(code, ...message) {},
+   warn(code) {}
-   debug(code, ...message) {}
+   debug(code, metadata) {}
}
```

[https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.19](https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.19)ì—ì„œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤.

## `nodemailer`[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#nodemailer "Direct link to heading")

`typeorm` ë° `prisma`ì™€ ë§ˆì°¬ê°€ì§€ë¡œ [`nodemailer`](https://npmjs.com/package/nodemailer)ëŠ” ì´ì œ ë” ì´ìƒ ê¸°ë³¸ì ìœ¼ë¡œ ì¢…ì†ì ì´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë§Œì•½ ì´ë©”ì¼ ê³µê¸‰ìë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° í”„ë¡œì íŠ¸ì— ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•˜ê±°ë‚˜, ê¸°íƒ€ ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì•ˆì— [`sendVerificationRequest`](https://nextauth-ko.wsbox.pw/configuration/providers/email#options-1#:~:text=sendVerificationRequest)ì½œë°±ì„ ì‚¬ìš©í•˜ì„¸ìš”. ì´ë ‡ê²Œ í•˜ë©´ ì´ë©”ì¼ ì œê³µì—…ì²´ë¥¼ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš° ë²ˆë“¤ í¬ê¸°ê°€ ì¤„ì–´ë“­ë‹ˆë‹¤. ì´ë©”ì¼ ê³µê¸‰ìë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë§¤ì§ë§í¬ ê¸°ëŠ¥ì´ ì‘ë™í•˜ë ¤ë©´ ì¸ì¦ í† í°ì´ ì¥ê¸°ê°„ ìœ ì§€ë˜ì–´ì•¼ í•˜ë¯€ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ì–´ëŒ‘í„°ë„ ë°˜ë“œì‹œ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” ì ì„ ê¸°ì–µí•˜ì„¸ìš”.

[https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.2](https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.2)ì—ì„œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤.

## í…Œë§ˆ[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#theme "Direct link to heading")

`signin`, `signout` ë“±ê³¼ ê°™ì€ ê¸°ë³¸ ì œê³µ í˜ì´ì§€ì— ëª‡ ê°€ì§€ ê¸°ë³¸ ì‚¬ìš©ì ì§€ì • ì˜µì…˜ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ì˜µì…˜ì€ `theme` êµ¬ì„± í‚¤ì—ì„œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì „ì—ëŠ” ìƒ‰ êµ¬ì„±í‘œ ì˜µì…˜ë§Œ ì œì–´í•˜ëŠ” ë¬¸ìì—´ì´ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë‹¤ìŒê³¼ ê°™ì€ ì˜µì…˜ì´ ìˆëŠ” ê°ì²´ì…ë‹ˆë‹¤:

```js
theme: {
  colorScheme: "auto", // "auto" | "dark" | "light"
  brandColor: "", // Hex color value
  logo: "" // Absolute URL to logo image
}
```

ìµœì†Œí•œì˜ êµ¬ì„±/ì‚¬ìš©ì ì •ì˜ ì˜µì…˜ì„ í†µí•´ ì‚¬ìš©ìê°€ ê¸°ë³¸ ì œê³µ í˜ì´ì§€ë¥¼ ìì‹ ë§Œì˜ í˜ì´ì§€ë¡œ êµì²´í•  í•„ìš”ì„±ì„ ë°”ë¡œ ëŠë¼ì§€ ì•Šê¸°ë¥¼ ë°”ëë‹ˆë‹¤.

ìƒˆë¡œìš´ í…Œë§ˆ ì˜µì…˜ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ê³¼ ìŠ¤í¬ë¦°ìƒ·ì€ [êµ¬ì„±/í˜ì´ì§€](https://nextauth-ko.wsbox.pw/configuration/pages#theming)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[#2788](https://github.com/nextauthjs/next-auth/pull/2788)ì—ì„œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤.

## ì„¸ì…˜[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#session "Direct link to heading")

`session.jwt: boolean` ì˜µì…˜ì´ `session.strategy: "jwt" | "database"`ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‚¬ìš©ìì˜ ì˜µì…˜ì„ ë³´ë‹¤ ì§ê´€ì ìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•œ ê²ƒì…ë‹ˆë‹¤:

1.  ì–´ëŒ‘í„° ì—†ìŒ, `strategy: "jwt"`: ê¸°ë³¸ê°’ì…ë‹ˆë‹¤. ì„¸ì…˜ì€ ì¿ í‚¤ì— ì €ì¥ë˜ë©° ì–´ë””ì—ë„ ì§€ì†ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
2.  ì–´ëŒ‘í„° ì‚¬ìš©, `strategy: "database"`: ì–´ëŒ‘í„°ê°€ ì •ì˜ëœ ê²½ìš° ì´ ì„¤ì •ì´ ì•”ì‹œì  ì„¤ì •ì´ ë©ë‹ˆë‹¤. ì‚¬ìš©ì êµ¬ì„±ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
3.  ì–´ëŒ‘í„° ì‚¬ìš©, `strategy: "jwt"`: ì‚¬ìš©ìëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²½ìš°ì—ë„ ëª…ì‹œì ìœ¼ë¡œ `next-auth`ì— JWTë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì§€ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë³´ì•ˆì´ ì €í•˜ë˜ëŠ” ëŒ€ì‹  ì¡°íšŒ ì†ë„ê°€ ë¹¨ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸íˆ ì•Œì•„ë³´ì„¸ìš”: [https://nextauth-ko.wsbox.pw/faq#json-web-tokens](https://nextauth-ko.wsbox.pw/faq#json-web-tokens)


ì˜ˆì‹œ:

```diff
session: {
- jwt: true,
+ strategy: "jwt",
}
```

[#3144](https://github.com/nextauthjs/next-auth/pull/3144)ì—ì„œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤.

## ì–´ëŒ‘í„°[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#adapters "Direct link to heading")

ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ `next-auth`ì½”ì–´ íŒ¨í‚¤ì§€ê°€ ë” ì´ìƒ ê¸°ë³¸ì ìœ¼ë¡œ `typeorm` ë˜ëŠ” ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ ì–´ëŒ‘í„°ì™€ í•¨ê»˜ ì œê³µë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë³´ì¡´í•  í•„ìš”ê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ë²ˆë“¤ í¬ê¸°ê°€ í¬ê²Œ ì¤„ì–´ë“­ë‹ˆë‹¤.

ê³µì‹ ì–´ëŒ‘í„°ëŠ” ê¸°ë³¸ ëª¨ë…¸ë ˆí¬ì˜ `packages` ë””ë ‰í† ë¦¬ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤([nextauthjs/next-auth](https://github.com/nextauthjs/next-auth)). ìƒˆë¡œìš´ [ê°„ì†Œí™”ëœ ì–´ëŒ‘í„° API](https://github.com/nextauthjs/next-auth/pull/2361)ë¥¼ ì‚¬ìš©í•˜ì—¬ [ì§ì ‘ ìƒì„±](https://nextauth-ko.wsbox.pw/tutorials/creating-a-database-adapter)í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ë§Œì•½ `3.x.x` ë˜ëŠ” ì´ì „ ë²„ì „ì˜ NextAuth.jsë¡œ ë§Œë“  ë°ì´í„°ë² ì´ìŠ¤ê°€ ìˆëŠ” ê²½ìš° ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤í–‰í•˜ì—¬ ìŠ¤í‚¤ë§ˆë¥¼ ìƒˆ ë²„ì „ 4 ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ë¡œ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ë³„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ˆëŠ” í•˜ë‹¨ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

1.  ê¸°ë³¸ ì œê³µëœ TypeORM ë˜ëŠ” Prisma ì–´ëŒ‘í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, `next-auth`ì½”ì–´ íŒ¨í‚¤ì§€ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤í–‰íˆ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ê°„ë‹¨í•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ìš© ì™¸ë¶€ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ê³  `[...nextauth].js`ì—ì„œ ê°€ì ¸ì˜¤ê¸°ë¥¼ ë³€ê²½í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

`database` ì˜µì…˜ì´ ì œê±°ë˜ì—ˆìœ¼ë¯€ë¡œ, ì´ì œ `database` ì˜µì…˜ëŒ€ì‹  ë‹¤ìŒê³¼ ê°™ì´ í•´ì•¼ í•©ë‹ˆë‹¤:
```diff title="[...nextauth].js"
import NextAuth from "next-auth"
+ import { TypeORMLegacyAdapter } from "@next-auth/typeorm-legacy-adapter"

...
export default NextAuth({
-   database: "yourconnectionstring",
+   adapter: TypeORMLegacyAdapter("yourconnectionstring")
})
```

2. `prisma-legacy` ì–´ëŒ‘í„°ê°€ ì œê±°ë˜ì—ˆìœ¼ë©°, ëŒ€ì‹  [`@next-auth/prisma-adapter`](https://npmjs.com/package/@next-auth/prisma-adapter)ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

3. `typeorm-legacy` ì–´ëŒ‘í„°ëŠ” ìƒˆë¡œìš´ ì–´ëŒ‘í„° APIë¡œ ì—…ê·¸ë ˆì´ë“œë˜ì—ˆì§€ë§Œ, `typeorm-legacy`ë¼ëŠ” ì´ë¦„ì€ ìœ ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. í–¥í›„ì—ëŠ” ê° ë°ì´í„°ë² ì´ìŠ¤ ìœ í˜•ì— ë§ì¶˜ ê°€ë²¼ìš´ ì–´ëŒ‘í„°ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ê±°ë‚˜ `typeorm`ì„ êµì²´í•  ê³„íšì…ë‹ˆë‹¤.

4.  MongoDBëŠ” `@next-auth/mongodb-adapter`ë¼ëŠ” ìì²´ ì–´ëŒ‘í„°ë¡œ ë¶„ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [MongoDB ì–´ëŒ‘í„° ë¬¸ì„œ](https://authjs.dev/getting-started/adapters/mongodb)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

ì´ ë³€ê²½ ì‚¬í•­ë“¤ì€ [https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.8](https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.8) ë° [#2361](https://github.com/nextauthjs/next-auth/pull/2361)ì—ì„œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤.

### ì–´ëŒ‘í„° API[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#adapter-api "Direct link to heading")

**ì‚¬ìš©ìì—ê²ŒëŠ” ë³€ê²½ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŠ” ì–´ëŒ‘í„°ì—ë§Œ í•´ë‹¹í•˜ëŠ” ë³€ê²½ ì‚¬í•­ì…ë‹ˆë‹¤.**

NextAuth.js v4ì—ì„œ ì–´ëŒ‘í„° APIê°€ ë‹¤ì‹œ ì‘ì„±ë˜ê³  í¬ê²Œ ë‹¨ìˆœí™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ì–´ëŒ‘í„°ëŠ” ë” ì ì€ ì‘ì—…ì„ í•˜ê²Œ ë˜ë©°, ì¼ë¶€ ê¸°ëŠ¥(ì˜ˆ: [ê²€ì¦ í† í°](https://authjs.dev/concepts/database-models#verificationtoken) í•´ì‹±)ì´ NextAuthì˜ ì½”ì–´ë¡œ ì´ë™ë˜ì—ˆìŠµë‹ˆë‹¤.

ì–´ëŒ‘í„° ìœ ì§€ë³´ìˆ˜ìì´ê±°ë‚˜ ì§ì ‘ ì–´ëŒ‘í„°ë¥¼ ì‘ì„±í•˜ë ¤ëŠ” ê²½ìš° [#2361](https://github.com/nextauthjs/next-auth/pull/2361) ë° [https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.22](https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.22)ì—ì„œ ì´ ë³€ê²½ ì‚¬í•­ì— ëŒ€í•œ ì¶”ê°€ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ìŠ¤í‚¤ë§ˆ ë³€ê²½[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#schema-changes "Direct link to heading")

ì–´ëŒ‘í„° APIê°€ ìƒˆë¡­ê²Œ ë³€ê²½ë˜ë©´ì„œ ë°ì´í„° ì €ì¥ ë°©ì‹ì´ ì•½ê°„ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì–´ëŒ‘í„° APIë¡œ, ì¶”ê°€ í•„ë“œë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì‰½ê²Œ í™•ì¥í•  ìˆ˜ ìˆë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ìš©ìì˜ `phone` í•„ë“œê°€ í•„ìš”í•  ê²½ìš°, ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì— í•´ë‹¹ í•„ë“œë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ë©°, ì–´ëŒ‘í„°ì—ì„œëŠ” ë³€ê²½ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

- `created_at`/`createdAt` ë° `updated_at`/`updatedAt` í•„ë“œëŠ” ëª¨ë“  ëª¨ë¸ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
- `user_id`/`userId`ëŠ” ì¼ê´€ë˜ê²Œ `userId`ë¡œ ì´ë¦„ì´ í†µì¼ë˜ì—ˆìŠµë‹ˆë‹¤.
- `compound_id`/`compoundId`ëŠ” Accountì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
- `access_token`/`accessToken`ì€ Sessionì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
- `email_verified`/`emailVerified`ëŠ” ì¼ê´€ë˜ê²Œ `emailVerified`ë¡œ ì´ë¦„ì´ í†µì¼ë˜ì—ˆìŠµë‹ˆë‹¤.
- `provider_id`/`providerId`ëŠ” Accountì—ì„œ `provider`ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
- `provider_type`/`providerType`ì€ Accountì—ì„œ `type`ìœ¼ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
- `provider_account_id`/`providerAccountId`ëŠ” Accountì—ì„œ ì¼ê´€ë˜ê²Œ `providerAccountId`ë¡œ ì´ë¦„ì´ í†µì¼ë˜ì—ˆìŠµë‹ˆë‹¤.
- `access_token_expires`/`accessTokenExpires`ëŠ” Accountì—ì„œ `expires_at`ìœ¼ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
- Accountì— ìƒˆ í•„ë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤: `token_type`, `scope`, `id_token`, `session_state`
- `verification_requests` í…Œì´ë¸”ì€ `verification_tokens`ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.

<details>
  <summary>ë³€ê²½ì‚¬í•­ ë³´ê¸°</summary>
```diff
  User {
  id
  name
  email
+ emailVerified
- email_verified
  image
-  created_at
-  updated_at
}

Account {
  id
- compound_id
- user_id
+ userId
-  provider_type
+ type
- provider_id
+ provider
- provider_account_id
+ providerAccountId
  refresh_token
  access_token
- access_token_expires
+ expires_in
+ expires_at
+ token_type
+ scope
+ id_token
+ session_state
- created_at
- updated_at
}

Session {
  id
  userId
  expires
  sessionToken
- access_token
- created_at
- updated_at
}

VerificationToken {
  id
  token
  expires
  identifier
- created_at
- updated_at
}
  ```
</details>

ìì„¸í•œ ì •ë³´ëŠ” [ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸](https://authjs.dev/concepts/database-models)í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ì„¸ìš”.

### ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#database-migration "Direct link to heading")

NextAuth.js v4ëŠ” v3ì™€ ë¹„êµí•˜ì—¬ ì•½ê°„ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ì–´ëŒ‘í„°ë¥¼ ì‚¬ìš© ì¤‘ì´ê³  ì—…ê·¸ë ˆì´ë“œë¥¼ ì›í•œë‹¤ë©´, ì•„ë˜ ìŠ¤í‚¤ë§ˆ ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ìŠ¤í‚¤ë§ˆë“¤ì€ ì§ì ‘ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ì¦‰, Prisma, TypeORM ë“±ì˜ ë¬¸ë²•ì— ë§ì¶˜ í•˜ë‚˜ì˜ ìŠ¤í‚¤ë§ˆê°€ ì•„ë‹ˆë¼, ê°ê°ì˜ ë°ì´í„°ë² ì´ìŠ¤ ìœ í˜•ì— ë§ì¶˜ ìŠ¤í‚¤ë§ˆë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Postgresìš© í•˜ë‚˜, MySQLìš© í•˜ë‚˜, MongoDBìš© í•˜ë‚˜ ë“±ìœ¼ë¡œ ë‚˜ë‰˜ì–´ ìˆìŠµë‹ˆë‹¤.
#### MySQL[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#mysql "Direct link to heading")

```sql
/* ACCOUNT */
ALTER TABLE accounts
CHANGE "access_token_expires" "expires_at" int
CHANGE "user_id" "userId" varchar(255)
ADD CONSTRAINT fk_user_id FOREIGN KEY (userId) REFERENCES users(id)
RENAME COLUMN "provider_id" "provider"
RENAME COLUMN "provider_account_id" "providerAccountId"
DROP COLUMN "provider_type"
DROP COLUMN "compound_id"
/* ë‹¤ìŒ ë‘ íƒ€ì„ìŠ¤íƒ¬í”„ ì—´ì€ NextAuth.jsì˜ ê¸°ëŠ¥ì„ ìœ„í•´ í•„ìˆ˜ì ì´ì§€ ì•Šì•˜ì§€ë§Œ, ì›í•œë‹¤ë©´ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. */
DROP COLUMN "created_at"
DROP COLUMN "updated_at"

ADD COLUMN "token_type" varchar(255) NULL
ADD COLUMN "scope" varchar(255) NULL
ADD COLUMN "id_token" varchar(255) NULL
ADD COLUMN "session_state" varchar(255) NULL

/* ì°¸ê³ : ì´ëŠ” êµ¬ ë²„ì „ì˜ Twitter OAuth 1.0 ì œê³µìë¥¼ ì‚¬ìš©í•  ê²½ìš°ì—ë§Œ í•„ìš”í•©ë‹ˆë‹¤. */
ADD COLUMN "oauth_token_secret" varchar(255) NULL
ADD COLUMN "oauth_token" varchar(255) NULL

/* USER */
ALTER TABLE users
RENAME COLUMN "email_verified" "emailVerified"
/* ë‹¤ìŒ ë‘ íƒ€ì„ìŠ¤íƒ¬í”„ ì—´ì€ NextAuth.jsì˜ ê¸°ëŠ¥ì„ ìœ„í•´ í•„ìˆ˜ì ì´ì§€ ì•Šì•˜ì§€ë§Œ, ì›í•œë‹¤ë©´ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. */
DROP COLUMN "created_at"
DROP COLUMN "updated_at"

/* SESSION */
ALTER TABLE sessions
RENAME COLUMN "session_token" "sessionToken"
CHANGE "user_id" "userId" varchar(255)
ADD CONSTRAINT fk_user_id FOREIGN KEY (userId) REFERENCES users(id)
DROP COLUMN "access_token"
/* ë‹¤ìŒ ë‘ íƒ€ì„ìŠ¤íƒ¬í”„ ì—´ì€ NextAuth.jsì˜ ê¸°ëŠ¥ì„ ìœ„í•´ í•„ìˆ˜ì ì´ì§€ ì•Šì•˜ì§€ë§Œ, ì›í•œë‹¤ë©´ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. */
DROP COLUMN "created_at"
DROP COLUMN "updated_at"

/* VERIFICATION REQUESTS */
ALTER TABLE verification_requests RENAME verification_tokens
ALTER TABLE verification_tokens
DROP COLUMN id
/* ë‹¤ìŒ ë‘ íƒ€ì„ìŠ¤íƒ¬í”„ ì—´ì€ NextAuth.jsì˜ ê¸°ëŠ¥ì„ ìœ„í•´ í•„ìˆ˜ì ì´ì§€ ì•Šì•˜ì§€ë§Œ, ì›í•œë‹¤ë©´ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. */
DROP COLUMN "created_at"
DROP COLUMN "updated_at"
```

#### Postgres[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#postgres "Direct link to heading")

```sql
/* ACCOUNT */
ALTER TABLE accounts RENAME COLUMN "user_id" TO "userId";
ALTER TABLE accounts RENAME COLUMN "provider_id" TO "provider";
ALTER TABLE accounts RENAME COLUMN "provider_account_id" TO "providerAccountId";
ALTER TABLE accounts RENAME COLUMN "access_token_expires" TO "expires_at";
ALTER TABLE accounts RENAME COLUMN "provider_type" TO "type";

/* TIMESTAMPTZì—ì„œ BIGINTë¡œì˜ ë³€í™˜ */
ALTER TABLE accounts ALTER COLUMN "expires_at" TYPE TEXT USING CAST(extract(epoch FROM "expires_at") AS BIGINT)*1000;

/* ORMì„ ì‚¬ìš©í•  ë•Œ `id`ëŠ” ìë™ ì¦ê°€ë¥¼ ì§€ì›í•˜ëŠ” `SERIAL`ë¡œ ìœ ì§€í•˜ì‹­ì‹œì˜¤. ìƒˆë¡œìš´ v4 UUID í˜•ì‹ì€ í˜¸í™˜ì„± ë¬¸ì œë¡œ ì¸í•´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. */
/* ALTER TABLE accounts ALTER COLUMN "id" TYPE TEXT; */
/* ALTER TABLE accounts ALTER COLUMN "userId" TYPE TEXT; */
ALTER TABLE accounts ALTER COLUMN "type" TYPE TEXT;
ALTER TABLE accounts ALTER COLUMN "provider" TYPE TEXT;
ALTER TABLE accounts ALTER COLUMN "providerAccountId" TYPE TEXT;

ALTER TABLE accounts ADD CONSTRAINT fk_user_id FOREIGN KEY ("userId") REFERENCES users(id);
ALTER TABLE accounts
DROP COLUMN IF EXISTS "compound_id";
/* ë‹¤ìŒ ë‘ ê°œì˜ íƒ€ì„ìŠ¤íƒ¬í”„ ì—´ì€ NextAuth.jsê°€ ì‘ë™í•˜ëŠ” ë° í•„ìš”í•˜ì§€ ì•Šì§€ë§Œ, ì›í•œë‹¤ë©´ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. */
ALTER TABLE accounts
DROP COLUMN IF EXISTS "created_at",
DROP COLUMN IF EXISTS "updated_at";

ALTER TABLE accounts
ADD COLUMN IF NOT EXISTS "token_type" TEXT NULL,
ADD COLUMN IF NOT EXISTS "scope" TEXT NULL,
ADD COLUMN IF NOT EXISTS "id_token" TEXT NULL,
ADD COLUMN IF NOT EXISTS "session_state" TEXT NULL;
/* ì°¸ê³ : ì´ëŠ” êµ¬ ë²„ì „ì˜ Twitter OAuth 1.0 ì œê³µìë¥¼ ì‚¬ìš©í•  ê²½ìš°ì—ë§Œ í•„ìš”í•©ë‹ˆë‹¤. */
/* ALTER TABLE accounts
ADD COLUMN IF NOT EXISTS "oauth_token_secret" TEXT NULL,
ADD COLUMN IF NOT EXISTS "oauth_token" TEXT NULL; */

/* USER */
ALTER TABLE users RENAME COLUMN "email_verified" TO "emailVerified";

/* ORMì„ ì‚¬ìš©í•  ë•Œ `id`ëŠ” ìë™ ì¦ê°€ë¥¼ ì§€ì›í•˜ëŠ” `SERIAL`ë¡œ ìœ ì§€í•˜ì‹­ì‹œì˜¤. ìƒˆë¡œìš´ v4 UUID í˜•ì‹ì€ í˜¸í™˜ì„± ë¬¸ì œë¡œ ì¸í•´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. */
/* ALTER TABLE users ALTER COLUMN "id" TYPE TEXT; */
ALTER TABLE users ALTER COLUMN "name" TYPE TEXT;
ALTER TABLE users ALTER COLUMN "email" TYPE TEXT;
ALTER TABLE users ALTER COLUMN "image" TYPE TEXT;
/* TIMESTAMPTZë¥¼ BIGINTë¡œ ë³€í™˜í•œ ë‹¤ìŒ TEXTë¡œ ë³€í™˜ */
ALTER TABLE users ALTER COLUMN "emailVerified" TYPE TEXT USING CAST(CAST(extract(epoch FROM "emailVerified") AS BIGINT)*1000 AS TEXT);
/* ë‹¤ìŒ ë‘ ê°œì˜ íƒ€ì„ìŠ¤íƒ¬í”„ ì—´ì€ NextAuth.jsê°€ ì‘ë™í•˜ëŠ” ë° í•„ìš”í•˜ì§€ ì•Šì§€ë§Œ, ì›í•œë‹¤ë©´ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. */
ALTER TABLE users
DROP COLUMN IF EXISTS "created_at",
DROP COLUMN IF EXISTS "updated_at";

/* SESSION */
ALTER TABLE sessions RENAME COLUMN "session_token" TO "sessionToken";
ALTER TABLE sessions RENAME COLUMN "user_id" TO "userId";

/* ORMì„ ì‚¬ìš©í•  ë•Œ `id`ëŠ” ìë™ ì¦ê°€ë¥¼ ì§€ì›í•˜ëŠ” `SERIAL`ë¡œ ìœ ì§€í•˜ì‹­ì‹œì˜¤. ìƒˆë¡œìš´ v4 UUID í˜•ì‹ì€ í˜¸í™˜ì„± ë¬¸ì œë¡œ ì¸í•´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. */
/* ALTER TABLE sessions ALTER COLUMN "id" TYPE TEXT; */
/* ALTER TABLE sessions ALTER COLUMN "userId" TYPE TEXT; */
ALTER TABLE sessions ALTER COLUMN "sessionToken" TYPE TEXT;
ALTER TABLE sessions ADD CONSTRAINT fk_user_id FOREIGN KEY ("userId") REFERENCES users(id);
/* TIMESTAMPTZë¥¼ BIGINTë¡œ ë³€í™˜í•œ ë‹¤ìŒ TEXTë¡œ ë³€í™˜í•˜ê¸° */
ALTER TABLE sessions ALTER COLUMN "expires" TYPE TEXT USING CAST(CAST(extract(epoch FROM "expires") AS BIGINT)*1000 AS TEXT);
ALTER TABLE sessions DROP COLUMN IF EXISTS "access_token";
/* ë‹¤ìŒ ë‘ ê°œì˜ íƒ€ì„ìŠ¤íƒ¬í”„ ì—´ì€ NextAuth.jsê°€ ì‘ë™í•˜ëŠ” ë° í•„ìš”í•˜ì§€ ì•Šì§€ë§Œ, ì›í•œë‹¤ë©´ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. */
ALTER TABLE sessions
DROP COLUMN IF EXISTS "created_at",
DROP COLUMN IF EXISTS "updated_at";

/* VERIFICATION REQUESTS */
ALTER TABLE verification_requests RENAME TO verification_tokens;
/* ORMì´ í•„ìš”ë¡œ í•˜ëŠ” `id` ìœ ì§€ */
/* ALTER TABLE verification_tokens DROP COLUMN IF EXISTS id; */
ALTER TABLE verification_tokens ALTER COLUMN "identifier" TYPE TEXT;
ALTER TABLE verification_tokens ALTER COLUMN "token" TYPE TEXT;
/* TIMESTAMPTZë¥¼ BIGINTë¡œ ë³€í™˜í•œ ë‹¤ìŒ TEXTë¡œ ë³€í™˜í•˜ê¸° */
ALTER TABLE verification_tokens ALTER COLUMN "expires" TYPE TEXT USING CAST(CAST(extract(epoch FROM "expires") AS BIGINT)*1000 AS TEXT);
/* ë‹¤ìŒ ë‘ ê°œì˜ íƒ€ì„ìŠ¤íƒ¬í”„ ì—´ì€ NextAuth.jsê°€ ì‘ë™í•˜ëŠ” ë° í•„ìš”í•˜ì§€ ì•Šì§€ë§Œ, ì›í•œë‹¤ë©´ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. */
ALTER TABLE verification_tokens
DROP COLUMN IF EXISTS "created_at",
DROP COLUMN IF EXISTS "updated_at";
```

#### MongoDB[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#mongodb "Direct link to heading")

MongoDBëŠ” ë¬¸ì„œí˜• ë°ì´í„°ë² ì´ìŠ¤ì´ë¯€ë¡œ ìƒˆë¡œìš´ í•„ë“œëŠ” ìë™ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¬ì‚¬ìš©ë  ê¸°ì¡´ í•„ë“œì˜ ì´ë¦„ì€ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.

```mongodb
db.getCollection('accounts').updateMany({}, {
  $rename: {
    "provider_id": "provider",
    "provider_account_id": "providerAccountId",
    "user_id": "userId",
    "access_token_expires": "expires_at"
  }
})
db.getCollection('users').updateMany({}, {
  $rename: {
    "email_verified": "emailVerified"
  }
})
db.getCollection('sessions').updateMany({}, {
  $rename: {
    "session_token": "sessionToken",
    "user_id": "userId"
  }
})
```

## `secret` ëˆ„ë½[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#missing-secret "Direct link to heading")

NextAuth.jsëŠ” ì‚¬ìš©ìê°€ ì •ì˜í•˜ì§€ ì•Šì€ ê²½ìš° í¸ì˜ì„±ì„ ìœ„í•´ ë¹„ë°€(secret)ì„ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ëŠ” ê°œë°œ í™˜ê²½ì—ì„œëŠ” ìœ ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ë¬¸ì„œì—ì„œ ì´ì— ëŒ€í•´ í•­ìƒ ëª…í™•íˆ ë°í˜€ì™”ì§€ë§Œ, ì´ì œë¶€í„°ëŠ” ìš´ì˜ í™˜ê²½ì—ì„œ `secret` ì†ì„±ì„ ì •ì˜í•˜ì§€ ì•Šìœ¼ë©´ ì‚¬ìš©ìì—ê²Œ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ì´ ì˜µì…˜ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](https://nextauth-ko.wsbox.pw/configuration/options#secret)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ `secret` êµ¬ì„± ì˜µì…˜ì— ë„£ì„ ë¹„ë°€ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
$ openssl rand -base64 32
```

ë”°ë¼ì„œ, ë‹¹ì‹ ì˜ NextAuth.js êµ¬ì„±ì€ ë‹¤ìŒê³¼ ë¹„ìŠ·í•´ì•¼ í•©ë‹ˆë‹¤:

```js title="/pages/api/auth/\[...nextauth\].js"
...
export default NextAuth({
  ...
  providers: [...],
  secret: "LlKq6ZtYbr+hTC073mAmAh9/h2HwMfsFo4hrfCx5mLg=",
  ...
})
```

[#3143](https://github.com/nextauthjs/next-auth/issues/3143)ì—ì„œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤.

## ì„¸ì…˜ `strategy`[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#session-strategy "Direct link to heading")

ìš°ë¦¬ëŠ” í•­ìƒ ë‘ ê°€ì§€ ë‹¤ë¥¸ ì„¸ì…˜ ì „ëµì„ ì§€ì›í•´ì™”ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ëŠ” ê°€ì¥ ì¸ê¸° ìˆê³  ê¸°ë³¸ ì „ëµì¸ JWT ê¸°ë°˜ ì „ëµì…ë‹ˆë‹¤. ë‘ ë²ˆì§¸ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì–´ëŒ‘í„° ì§€ì† ì„¸ì…˜ ì „ëµì…ë‹ˆë‹¤. ë‘ ì „ëµ ëª¨ë‘ ì¥ë‹¨ì ì´ ìˆìœ¼ë©°, ë” ë§ì€ ë‚´ìš©ì„ ì•Œê³  ì‹¶ìœ¼ì‹œë©´ [FAQ](https://nextauth-ko.wsbox.pw/faq) í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

ì´ì „ì—ëŠ” `session` ì˜µì…˜ì˜ `jwt: boolean` í”Œë˜ê·¸ë¥¼ í†µí•´ ì´ ì„¤ì •ì„ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤. `session`ê³¼ `jwt`ë¼ëŠ” ì´ë¦„ì€ ì˜µì…˜ì—ì„œ ë‹¤ì†Œ ê³¼ìš©ë˜ì—ˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë” ëª…í™•í•œ ë©”ì‹œì§€ë¥¼ ìœ„í•´ ì´ ì˜µì…˜ì˜ ì´ë¦„ì„ `strategy: "jwt" | "database"`ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤. ì—¬ì „íˆ `session` ê°ì²´ì— í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì´ ì˜µì…˜ì˜ ëª©ì ì„ ë” ì˜ ë‚˜íƒ€ë‚´ê³  ì–´ë–¤ ìœ í˜•ì˜ ì„¸ì…˜ì„ ì‚¬ìš©í•  ê²ƒì¸ì§€ ëª…í™•íˆ í•˜ê¸°ë¥¼ í¬ë§í•©ë‹ˆë‹¤.

ìì„¸í•œ ë‚´ìš©ì€ [`session` ì˜µì…˜ ë¬¸ì„œ](https://nextauth-ko.wsbox.pw/configuration/options#session)ë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.

ì´ ë³€ê²½ ì‚¬í•­ì€ [#3144](https://github.com/nextauthjs/next-auth/pull/3144)ì—ì„œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤.

## ìš”ì•½[](https://nextauth-ko.wsbox.pw/getting-started/upgrade-v4#summary "Direct link to heading")

ìš°ë¦¬ëŠ” ì´ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì—¬ëŸ¬ë¶„ ëª¨ë‘ì—ê²Œ ìˆœì¡°ë¡­ê²Œ ì§„í–‰ë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤! ì§ˆë¬¸ì´ ìˆê±°ë‚˜ ì–´ë””ì—ì„œ ë§‰íˆë©´, ì–¸ì œë“ ì§€ GitHubì— [ìƒˆ ì´ìŠˆ](https://github.com/nextauthjs/next-auth/issues/new)ë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”.